
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
    
    <title>PostgreSQL / PostGIS &mdash; GDAL v1.9.0 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.9.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="top" title="GDAL v1.9.0 documentation" href="../../index.html" />
    <link rel="up" title="Formats vecteur d’OGR" href="index.html" />
    <link rel="next" title="Dump SQL pour PostgreSQL" href="pgdump.html" />
    <link rel="prev" title="PDS - Planetary Data Systems TABLE" href="pds.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="pgdump.html" title="Dump SQL pour PostgreSQL"
             accesskey="N">suivant</a></li>
        <li class="right" >
          <a href="pds.html" title="PDS - Planetary Data Systems TABLE"
             accesskey="P">précédent</a> |</li>
        <li><a href="../../index.html">GDAL v1.9.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >OGR</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Formats vecteur d&#8217;OGR</a> &raquo;</li> 
      </ul>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table des matières</a></h3>
            <ul>
<li><a class="reference internal" href="#">PostgreSQL / PostGIS</a><ul>
<li><a class="reference internal" href="#connexion-a-une-base-de-donnees">Connexion à une base de données</a></li>
<li><a class="reference internal" href="#les-colonnes-geometriques">Les colonnes géométriques</a></li>
<li><a class="reference internal" href="#requetes-sql">Requêtes SQL</a></li>
<li><a class="reference internal" href="#problemes-lors-de-la-creation">Problèmes lors de la création</a><ul>
<li><a class="reference internal" href="#options-de-creation-de-jeu-de-donnees">Options de création de jeu de données</a></li>
<li><a class="reference internal" href="#options-de-creation-de-couches">Options de création de couches</a></li>
<li><a class="reference internal" href="#options-de-configuration">Options de configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exemples">Exemples</a><ul>
<li><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lisez-egalement">Lisez également</a></li>
</ul>
</li>
</ul>

            <h4>Sujet précédent</h4>
            <p class="topless"><a href="pds.html"
                                  title="Chapitre précédent">PDS - Planetary Data Systems TABLE</a></p>
            <h4>Sujet suivant</h4>
            <p class="topless"><a href="pgdump.html"
                                  title="Chapitre suivant">Dump SQL pour PostgreSQL</a></p>
            <h3>Cette page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/ogr/formats/pg.txt"
                     rel="nofollow">Montrer la source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Recherche rapide</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="postgresql-postgis">
<span id="gdal-ogr-formats-pg"></span><h1>PostgreSQL / PostGIS<a class="headerlink" href="#postgresql-postgis" title="Lien permanent vers ce titre">¶</a></h1>
<p>Le pilote implémente la gestion de l&#8217;accès aux tables spatiales dans PostgreSQL
étendue par la gestion des données spatiales PostGIS. Une gestion existe dans
le pilote pour utiliser PostgreSQL sans <a class="reference external" href="http://postgis.org/">PostGIS</a>
mais avec moins de fonctionnalité.</p>
<p>Ce pilote nécessite une connexion à une base Postgres. Si vous voulez préparer un
dump SQL pour l&#8217;injecter plus tard dans une base Postgres, vous pouvez utiliser
plutôt <a class="reference internal" href="pgdump.html#gdal-ogr-formats-pgdump"><em>Dump SQL pour PostgreSQL</em></a> (GDAL/OGR &gt;= 1.8.0).</p>
<p>Vous pouvez trouver des informations additionnelles sur le pilote dans la page
<a class="reference internal" href="pg_advanced.html#gdal-ogr-formats-pg-advanced"><em>Informations avancées du pilote PostgreSQL / PostGIS</em></a>.</p>
<div class="section" id="connexion-a-une-base-de-donnees">
<h2>Connexion à une base de données<a class="headerlink" href="#connexion-a-une-base-de-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour se connecter à une source de données Postgres, utilisez une chaîne de
connections définissant le nom de la base de données, avec autant de paramètres
supplémentaires que nécessaire :</p>
<div class="highlight-python"><pre>PG:dbname=databasename</pre>
</div>
<p>ou</p>
<div class="highlight-python"><pre>PG:"dbname='databasename' host='addr' port='5432' user='x' password='y'"</pre>
</div>
<p>Il est également possible d&#8217;omettre le nom de la base de données et se connecter
à celle par défaut, avec le même nom comme le nom d&#8217;utilisateur.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">on utilise <em>PQconnectdb()</em> pour réaliser la connexion, n&#8217;importe quelles
autres options et valeurs par défauts qui pourraient s&#8217;y appliquer, s&#8217;applique
au nom (référez vous à la documentation du serveur PostgreSQL ici pour
<a class="reference external" href="http://www.postgresql.org/docs/8.4/interactive/libpq-connect.html">PostgreSQL 8.4</a>).
Le préfixe PG: est utilisé pour marquer le nom en tant que chaîne de connexion
postgres.</p>
</div>
</div>
<div class="section" id="les-colonnes-geometriques">
<h2>Les colonnes géométriques<a class="headerlink" href="#les-colonnes-geometriques" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si la table <em>geometry_columns</em> existe, alors toutes les tables listées et les
vues nommées seront traitées comme des couches OGR. Autrement toutes les tables
utilisateurs attributaires seront traitées comme des couches.</p>
<p>À partir de GDAL 1.7.0, le pilote gère également la colonne de type
<a class="reference external" href="http://postgis.refractions.net/documentation/manual-svn/ch04.html#PostGIS_Geography">geography</a>
introduit dans PostGIS 1.5.</p>
</div>
<div class="section" id="requetes-sql">
<h2>Requêtes SQL<a class="headerlink" href="#requetes-sql" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le pilote PostgreSQL envoie les commandes SQL directement à PostgreSQL par
défaut, plutôt que de les évaluer en interne lors de l&#8217;utilisation de l&#8217;appel
<em>ExecuteSQL()</em> sur <em>OGRDataSource</em>, ou l&#8217;option en ligne de commande <em>-sql</em>
pour <tt class="docutils literal"><span class="pre">ogr2ogr</span></tt>. Les expressions des requêtes attributaires sont également
envoyées à PostgreSQL. Il est aussi possible de questionner le pilote pour
prendre en charge les commandes avec le moteur <a class="reference internal" href="../sql.html#gdal-ogr-sql"><em>SQL dans OGR</em></a>, en passant
la chaine <em>OGRSQL</em> à la méthode <em>ExecuteSQL()</em>, comme nom du dialecte SQL.</p>
<p>Le pilote PostgreSQL dans OGR gère les appels <em>OGRDataSource::StartTrasaction()</em>,
<em>OGRDataSource::CommitTransaction()</em> et <em>OGRDataSource::RollbackTransaction()</em>
dans le sens normal de SQL.</p>
</div>
<div class="section" id="problemes-lors-de-la-creation">
<h2>Problèmes lors de la création<a class="headerlink" href="#problemes-lors-de-la-creation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le pilote PostgreSQL ne gère pas la création de nouveau jeu de données (une
base de données dans PostgreSQL), mais il permet la création de nouvelles
couches dans une base de données existante.</p>
<p>Comme mentionné au-dessus, le système du type est pauvre, et plusieurs types
d&#8217;OGR ne sont pas mappés correctement dans PostgreSQL.</p>
<p>Si la base de données a les types PostGIS chargés (c&#8217;est à dire le type
<em>geometry</em>) les nouvelles couches crées seront crées avec le type géométrique de
PostGIS. Autrement elles utiliseront un type OID. Par défaut il est supposé que
le texte envoyé à Postgres est encodé au format UTF-8. Cela convient pour
l&#8217;ASCII, mais peut entrainer des erreurs pour les caractères étendus (ASCII 155+
par exemple). Bien que OGR ne fournisse aucun contrôle direct pour cela, vous
pouvez définir la variable d&#8217;environnement <em>PGCLIENTENCODING</em> pour indiquer le
format qui est utilisé. Par exemple, si votre texte est LATIN1 vous pouvez
définir la variable d&#8217;environnement à LATIN1 avant d&#8217;utiliser OGR et les données
en entrées seront supposées être en LATIN1 au lieu de UTF-8.</p>
<p>Un moyen alternatif pour définir l&#8217;encodage du client est d&#8217;utiliser la commande
SQL suivante avec <em>ExecuteSQL()</em> : &#8220;<tt class="docutils literal"><span class="pre">SET</span> <span class="pre">client_encoding</span> <span class="pre">TO</span> <span class="pre">encoding_name</span></tt>&#8221; où
<em>encoding_name</em> est LATIN1, etc.</p>
<p>Les erreurs peuvent être récupérées en englobant cette commande avec la paire
<em>CPLPushErrorHandler()/CPLPopErrorHandler()</em>.</p>
<div class="section" id="options-de-creation-de-jeu-de-donnees">
<h3>Options de création de jeu de données<a class="headerlink" href="#options-de-creation-de-jeu-de-donnees" title="Lien permanent vers ce titre">¶</a></h3>
<p>Aucune.</p>
</div>
<div class="section" id="options-de-creation-de-couches">
<h3>Options de création de couches<a class="headerlink" href="#options-de-creation-de-couches" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li><strong>GEOM_TYPE :</strong> l&#8217;option de création de couche <em>GEOM_TYPE</em> peut être
définie à <em>Geometry</em>, &#8220;geography&#8221; (PostGIS &gt;= 1.5), <em>BYTEA</em> ou <em>OID</em> pour forcer le type de la géométrie
utilisée pour une table. Pour une base de données PostGIS, &#8220;geometry&#8221; est la
valeur par défaut.</li>
<li><strong>OVERWRITE :</strong> Il peut être définie à <em>YES</em> pour forcer une couche
existante du nom désiré à être détruite avant la création de la couche demandée.</li>
<li><strong>LAUNDER :</strong> Il peut être définie à <em>YES</em> pour forcer les nouveaux champs
crées sur cette couche à avoir les noms de champs &#8220;nettoyer&#8221; dans une forme
compatible avec PostgreSQL. Cela convertie en minuscule et convertie certains
caractères  spéciaux comme &#8220;-&#8221; et &#8220;#&#8221; en &#8220;_&#8221;. Si <em>NO</em> les noms exacts seront
préservés. La valeur par défaut est <em>YES</em>. Si activé le nom de la table
(couche) sera également nettoyer.</li>
<li><strong>PRECISION :</strong> Il peut être définie à <em>YES</em> pour forcer la création de
nouveaux champs dans cette couche pour essayer de représenter l&#8217;information de
précision et longueur, si disponible en utilisant les types
<em>NUMERIC(width,precision)</em> ou <em>CHAR(width)</em>. Si <em>NO</em> alors les types <em>FLOAT8</em>,
<em>INTEGER</em> et <em>VARCHAR</em> seront utilisé à la place. <em>YES</em> pas défaut.</li>
<li><strong>DIM={2,3} :</strong> Contrôle la dimension de la couche. 3 par défaut. Important
à définir à 2 pour les couches 2D avec PostGIS 1.0+ puisqu&#8217;il a des
contraintes sur la dimension de la géométrie pendant le chargement.</li>
<li><strong>GEOMETRY_NAME :</strong> définie le nom de la colonne géométrique dans une
nouvelle table. S&#8217;il est omis, sera définie par défaut à <em>wkb_geometry</em> pour
GEOM_TYPE=geometry, ou <em>the_geog</em> pour GEOM_TYPE=geography..</li>
<li><strong>SCHEMA :</strong> Définie le nom du schéma pour une nouvelle table. L&#8217;utilisation
d&#8217;un même nom de couche dans un schéma différent est gérée, mais pas dans un
schéma public ou autres. Notez que l&#8217;utilisation de l&#8217;option <em>-overwrite</em>
de <tt class="docutils literal"><span class="pre">ogr2ogr</span></tt> et de l&#8217;option <em>-lco SCHEMA=</em> en même temps ne fonctionnera
pas, puisque la commande <tt class="docutils literal"><span class="pre">ogr2ogr</span></tt> ne comprendra pas que la couche existante
doit être détruite dans le schéma défini. Utilisez l&#8217;option <em>-nln</em> de
<tt class="docutils literal"><span class="pre">ogr2ogr</span></tt> à la place, ou mieux la chaîne de connexion <em>active_schema</em>.
Voir ci-dessous les exemples.</li>
<li><strong>SPATIAL_INDEX :</strong> (à partir de GDAL 1.6.0) Définie à <em>ON</em> par défaut.
Créer un index spatial sur la colonne géométrique pour accélérer les requêtes.
Définissez-la à <em>OFF</em> pour la désactiver (a un effet seulement quand PostGIS
est disponible).</li>
<li><strong>TEMPORARY :</strong> (à partir de GDAL 1.8.0) définie à OFF par défaut. créé une table
temporaire au lieu d&#8217;une table permanente.</li>
<li><strong>NONE_AS_UNKNOWN :</strong> (à partir de GDAL 1.8.1) peut être définie à TRUE pour
forcer les couches non-spatiales (wkbNone) à être créées comme table spatiale
de type GEOMETRY (wkbUnknown), qui était le comportement avant GDAL 1.8.0. NO
par défaut, auquel cas une table régulière est créée et non enregistré dans la
table geometry_columns de PostGIS.</li>
<li><strong>FID :</strong> (à partir de GDAL 1.9.0) nom de la colonne FID à créer. &#8216;ogc_fid&#8217; par
défaut.</li>
<li><strong>EXTRACT_SCHEMA_FROM_LAYER_NAME :</strong> (à partir de GDAL 1.9.0) peut être définie
à NO pour éviter de considérer le caractère &#8221;.&#8221; comme séparateur entre le schéma
et le nom de la table. YES par défaut.</li>
</ul>
</div>
<div class="section" id="options-de-configuration">
<h3>Options de configuration<a class="headerlink" href="#options-de-configuration" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il y a une variété d&#8217;<a class="reference external" href="http://trac.osgeo.org/gdal/wiki/ConfigOptions">options de configuration</a>
qui aide à contrôler le comportement de ce pilote.</p>
<ul class="simple">
<li><strong>PG_USE_COPY :</strong> il peut être à &#8220;YES&#8221; pour utiliser <em>COPY</em> pour l&#8217;insertion
de données dans PostgreSQL. &#8216;&#8217;COPY&#8217;&#8217; est moins robuste que <em>INSERT</em>, mais
significativement plus rapide.</li>
<li><strong>PGSQL_OGR_FID :</strong> définie le nom d&#8217;une clé primaire au lieu de &#8216;ogc_fid&#8217;.
Utiliser seulement lors de l&#8217;ouverture d&#8217;une couche dont la clé primaire ne
peut pas être autodétectée.
Ignoré par <em>CreateLayer()</em> qui utilise l&#8217;option de création FID.</li>
</ul>
<ul class="simple">
<li><strong>PG_USE_BASE64 :</strong> (GDAL &gt;= 1.8.0) si définie à &#8220;YES&#8221;, les géométries seront
récupérées encodées en EWKB BASE64 au lieu de la forme canonique EWKB HEX.
Cela réduit la quantité de données transférée de 2 N à 1.333 N, où N est la
taille des données EWKB. Cependant, cela peut être un peu plus lent que récupérer
la forme canonique quand le client et le serveur sont sur la même machine, la
valeur par défaut est donc NO.</li>
</ul>
</div>
</div>
<div class="section" id="exemples">
<h2>Exemples<a class="headerlink" href="#exemples" title="Lien permanent vers ce titre">¶</a></h2>
<ul>
<li><p class="first">Des traductions simples de shapefile dans PostgreSQL. la table &#8216;abc&#8217; sera crée
avec les géométries de <em>abc.shp</em> et les attributs de <em>abc.dbf</em>. L&#8217;instance de
base de données (warmerda) doit déjà exister, et la table <em>abc</em> ne doit pas
être crée.</p>
<div class="highlight-python"><pre>% ogr2ogr -f PostgreSQL PG:dbname=warmerda abc.shp</pre>
</div>
</li>
<li><p class="first">Ce second exemple charge une couche des limites des pays à partir d&#8217;un VPF
(via le pilote OGDI), et renomme le nom énigmatique de la couche OGDI en un
nom plus lisible. Si une table existante du nom désiré existe, elle sera écrasée.</p>
<div class="highlight-python"><pre>% ogr2ogr -f PostgreSQL PG:dbname=warmerda \
          gltp:/vrf/usr4/mpp1/v0eur/vmaplv0/eurnasia \
          -lco OVERWRITE=yes -nln polbndl_bnd 'polbndl@bnd(*)_line'</pre>
</div>
</li>
<li><p class="first">Dans cet exemple nous fusionnons des données lignes tiger de deux répertoires
différents de fichier tiger dans une table. Notez que la seconde invocation
utilise <em>-append</em> et pas <em>OVERWRITE=yes</em>.</p>
<div class="highlight-python"><pre>% ogr2ogr -f PostgreSQL PG:dbname=warmerda tiger_michigan \
       -lco OVERWRITE=yes CompleteChain
% ogr2ogr -update -append -f PostgreSQL PG:dbname=warmerda tiger_ohio \
       CompleteChain</pre>
</div>
</li>
<li><p class="first">Cet exemple montre l&#8217;utilisation d&#8217;<tt class="docutils literal"><span class="pre">ogrinfo</span></tt> pour évaluer une commande de
requête SQL dans PostgreSQL. Des requêtes PostGIS plus sophistiquées peuvent
être utilisées également via la commande -sql dans <tt class="docutils literal"><span class="pre">ogrinfo</span></tt>.</p>
<div class="highlight-python"><pre>ogrinfo -ro PG:dbname=warmerda -sql "SELECT pop_1994 from canada where province_name = 'Alberta'"</pre>
</div>
</li>
<li><p class="first">Cet exemple montre l&#8217;utilisation de <tt class="docutils literal"><span class="pre">ogrinfo</span></tt> pour lister les couches
PostgreSQL/PostGIS sur un hôte différent.</p>
<div class="highlight-python"><pre>ogrinfo -ro PG:'host=myserver.velocet.ca user=postgres dbname=warmerda'</pre>
</div>
</li>
</ul>
<div class="section" id="faq">
<h3>FAQ<a class="headerlink" href="#faq" title="Lien permanent vers ce titre">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>Pourquoi ne puis pas voir mes tables ? PostGIS est installé et j&#8217;ai des données.</dt>
<dd><p class="first">Vous devez avoir les permissions sur toutes les tables que vous voulez lire
<em>et</em> geometry_columns et spatial_ref_sys.</p>
<p class="last">Un comportement erroné peut ne renvoyer aucun message d&#8217;erreur si vous n&#8217;avez
pas la permission à ces tables. Les problèmes de permission sur les tables
<em>geometry_columns</em> et/ou <em>spatial_ref_sys</em> peut être généralement confirmés
si vous pouvez voir les tables en définissant l&#8217;option de configuration
<em>PG_LIST_ALL_TABLES</em> à YES. (par exemple <tt class="docutils literal"><span class="pre">ogrinfo</span> <span class="pre">--config</span> <span class="pre">PG_LIST_ALL_TABLES</span> <span class="pre">YES</span> <span class="pre">PG:xxxxx</span></tt>).</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="lisez-egalement">
<h2>Lisez également<a class="headerlink" href="#lisez-egalement" title="Lien permanent vers ce titre">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="pg_advanced.html#gdal-ogr-formats-pg-advanced"><em>Informations avancées du pilote PostgreSQL / PostGIS</em></a></li>
<li><a class="reference internal" href="pgdump.html#gdal-ogr-formats-pgdump"><em>Dump SQL pour PostgreSQL</em></a></li>
<li><a class="reference external" href="http://www.postgresql.org/">Page principale de PostgreSQL</a></li>
<li><a class="reference external" href="http://postgis.org/">PostGIS</a></li>
<li><a class="reference external" href="http://postgis.fr">PostGIS en Français</a></li>
<li><a class="reference external" href="http://trac.osgeo.org/postgis/wiki/UsersWikiOGR">Page d&#8217;exemples dans le wiki sur PostGIS / OGR</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>


      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="pgdump.html" title="Dump SQL pour PostgreSQL"
             >suivant</a></li>
        <li class="right" >
          <a href="pds.html" title="PDS - Planetary Data Systems TABLE"
             >précédent</a> |</li>
        <li><a href="../../index.html">GDAL v1.9.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >OGR</a> &raquo;</li>
          <li><a href="index.html" >Formats vecteur d&#8217;OGR</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    <a href="http://creativecommons.org/licenses/by/2.0/fr/deed.fr">Licence Creative Common BY</a>
    <!--
      &copy; Copyright 2011, Yves Jacolin.-->
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>