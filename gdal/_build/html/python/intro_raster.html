
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
    
    <title>Raster &mdash; GDAL v1.9.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.9.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="GDAL v1.9.0 documentation" href="../index.html" />
    <link rel="up" title="Python" href="index.html" />
    <link rel="next" title="Bibliographie" href="bibliographie.html" />
    <link rel="prev" title="Vecteurs" href="intro_vecteur.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="bibliographie.html" title="Bibliographie"
             accesskey="N">suivant</a></li>
        <li class="right" >
          <a href="intro_vecteur.html" title="Vecteurs"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">GDAL v1.9.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Python</a> &raquo;</li> 
      </ul>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table des matières</a></h3>
            <ul>
<li><a class="reference internal" href="#">Raster</a><ul>
<li><a class="reference internal" href="#lire-un-fichier-raster">Lire un fichier Raster</a><ul>
<li><a class="reference internal" href="#les-drivers">Les drivers</a></li>
<li><a class="reference internal" href="#id1">Lire un fichier raster</a></li>
<li><a class="reference internal" href="#bande">Bande</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ecrire-un-fichier-raster">Écrire un fichier Raster</a></li>
</ul>
</li>
</ul>

            <h4>Sujet précédent</h4>
            <p class="topless"><a href="intro_vecteur.html"
                                  title="Chapitre précédent">Vecteurs</a></p>
            <h4>Sujet suivant</h4>
            <p class="topless"><a href="bibliographie.html"
                                  title="Chapitre suivant">Bibliographie</a></p>
            <h3>Cette page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/python/intro_raster.txt"
                     rel="nofollow">Montrer la source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Recherche rapide</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="raster">
<span id="gdal-python-raster-intro"></span><h1>Raster<a class="headerlink" href="#raster" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="lire-un-fichier-raster">
<h2>Lire un fichier Raster<a class="headerlink" href="#lire-un-fichier-raster" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="les-drivers">
<h3>Les drivers<a class="headerlink" href="#les-drivers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous devez charger les drivers pour les utiliser. Pour charger les drivers en
une fois (pour lire un raster seulement, pas pour écrire), utiliser :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">gdal</span><span class="o">.</span><span class="n">AllRegister</span><span class="p">()</span>
</pre></div>
</div>
<p>Puis créez votre objet driver :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s">&#39;SRTMHGT&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>enfin enregistrez le :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">driver</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Lire un fichier raster<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez maintenant lire un fichier raster sous forme de jeu de données
(dataset) :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;~/Local/Data/Raster/N43E004.hgt&#39;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">GA_ReadOnly</span><span class="p">)</span>
</pre></div>
</div>
<p>La méthode Open() prend deux paramètres : le chemin du fichier et la méthode de
lecture. Vous avez deux constantes possibles pour la méthode de lecture :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">GA_ReadOnly</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GA_Update</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Si python vous renvoie un message d&#8217;erreur sur la constante <em>GA_ReadOnly</em>, vous
pouvez la remplacer par sa valeur (0 donc).</p>
<p>Lorsque le jeu de données est chargé on test si son ouverture ne pose pas de
problème :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;impossible d ouvrir &#39;</span><span class="o">+</span><span class="nb">file</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Voici quelques méthodes définies pour récupérer de l&#8217;information sur vos données :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span> <span class="c"># obtenir la projection</span>
</pre></div>
</div>
<p>En plus des méthodes définie dans l&#8217;API il existe trois propriétés :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ds</span><span class="o">.</span><span class="n">RasterXSize</span>
<span class="n">ds</span><span class="o">.</span><span class="n">RasterYSize</span>
<span class="n">ds</span><span class="o">.</span><span class="n">RasterCount</span>
</pre></div>
</div>
</div>
<div class="section" id="bande">
<h3>Bande<a class="headerlink" href="#bande" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour travailler sur les pixels, nous devons obtenir la bande :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Puis récupérons les données dans un tableau :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">(</span><span class="n">xOffset</span><span class="p">,</span> <span class="n">yOffset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>1,1 est la taille de la cellule que nous voulons récupérer.</p>
<p>xOffset et yOffset sont obtenu en calculant la distance en pixel entre le bord
en haut à gauche et le point pour chaque axes (ordonnés et abscisses). Nous
connaissons les coordonnées du point haut gauche, la taille d&#8217;une cellule en
pixel. Nous avons donc :</p>
<div class="highlight-python"><pre>xOffset (en pixel) = (originX - X) (en coordonnées)
1 pixel            = pixelWidth (en coordonnées)
------------------------------------------------------
xOffset = (originX - X) (en coordonnées) / pixelWidth</pre>
</div>
<p>Même chose pour les ordonnées !</p>
<p>Si notre data set est la couche N43E004.hgt (format SRTM), gdalinfo nous donne ceci :</p>
<div class="highlight-python"><pre>$ gdalinfo N43E004.hgt
Driver: SRTMHGT/SRTMHGT File Format
Files: N43E004.hgt
Size is 1201, 1201
Coordinate System is:
GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        TOWGS84[0,0,0,0,0,0,0],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0,
        AUTHORITY["EPSG","8901"]],
    UNIT["degree",0.0174532925199433,
        AUTHORITY["EPSG","9108"]],
    AXIS["Lat",NORTH],
    AXIS["Long",EAST],
    AUTHORITY["EPSG","4326"]]
Origin = (3.999583333333333,44.000416666666666)
Pixel Size = (0.000833333333333,-0.000833333333333)
Corner Coordinates:
Upper Left  (   3.9995833,  44.0004167) (  3d59'58.50"E, 44d 0'1.50"N)
Lower Left  (   3.9995833,  42.9995833) (  3d59'58.50"E, 42d59'58.50"N)
Upper Right (   5.0004167,  44.0004167) (  5d 0'1.50"E, 44d 0'1.50"N)
Lower Right (   5.0004167,  42.9995833) (  5d 0'1.50"E, 42d59'58.50"N)
Center      (   4.5000000,  43.5000000) (  4d30'0.00"E, 43d30'0.00"N)
Band 1 Block=1201x1 Type=Int16, ColorInterp=Undefined
NoData Value=-32768
Unit Type: m</pre>
</div>
<p>En python faîtes :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">geotransform</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
<span class="n">originX</span> <span class="o">=</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">originY</span> <span class="o">=</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">pixelWidth</span> <span class="o">=</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pixelHeight</span> <span class="o">=</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>Si nous cherchons la valeur de la coordonnées (43.2, 4.2) :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">xOffset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">4.2</span> <span class="o">-</span> <span class="n">originX</span><span class="p">)</span> <span class="o">/</span> <span class="n">pixelWidth</span><span class="p">)</span>
<span class="n">yOffset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">43.2</span> <span class="o">-</span> <span class="n">originY</span><span class="p">)</span> <span class="o">/</span> <span class="n">pixelHeight</span><span class="p">)</span>
</pre></div>
</div>
<p>Si vous avez un offset négatif, il est fort probable que vous ayez choisit un point en dehors de la zone de couverture du raster. Nous pouvons relancer la commande suivante :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">(</span><span class="n">xOffset</span><span class="p">,</span> <span class="n">yOffset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Les données (cad la variable data) est un tableau en 2 dimensions de la taille qui a été définir plus haut (1,1). Pour récupérer une valeur du tableau :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Comment récupérer tous le raster dans le tableau à deux dimensions ? En définissant les offset à 0 et en donnant la largeur et la hauteur du raster dans la taille de la cellule à récupérer.</p>
<p>Le tableau de valeur est un tableau de colonne, les deux valeurs sont bien des colonnes et des lignes et non des coordonnées. De plus la première ligne et la première colonne commencent à 0 !</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Quelques conseils :</strong></p>
<p class="last">Ne lisez pas un pixel à chaque fois mais récupérer les tous en une fois, puis traiter les. Ne lisez qu&#8217;un pixel à la fois si vous êtes sur d&#8217;en avoir besoin que d&#8217;un ou deux ! Malheureusement pour de gros jeux de données, cela peut poser problème ;) La solution est d&#8217;utiliser la taille des blocs ou de lire une ligne et de faire le traitement voulut, puis la ligne suivante.
Ne traitez pas un pixel à la fois, mais utiliser les fonctions built-in de Python, notamment le module Numpy ou Numeric.</p>
</div>
</div>
</div>
<div class="section" id="ecrire-un-fichier-raster">
<h2>Écrire un fichier Raster<a class="headerlink" href="#ecrire-un-fichier-raster" title="Lien permanent vers ce titre">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>


      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="bibliographie.html" title="Bibliographie"
             >suivant</a></li>
        <li class="right" >
          <a href="intro_vecteur.html" title="Vecteurs"
             >précédent</a> |</li>
        <li><a href="../index.html">GDAL v1.9.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Python</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    <a href="http://creativecommons.org/licenses/by/2.0/fr/deed.fr">Licence Creative Common BY</a>
    <!--
      &copy; Copyright 2011, Yves Jacolin.-->
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>