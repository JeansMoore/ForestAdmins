
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
    
    <title>FAQ vecteur &mdash; GDAL v1.9.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.9.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="GDAL v1.9.0 documentation" href="../index.html" />
    <link rel="up" title="FAQ" href="index.html" />
    <link rel="next" title="FAQ Projection et système de coordonnées" href="proj.html" />
    <link rel="prev" title="F.A.Q. Raster" href="raster.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="proj.html" title="FAQ Projection et système de coordonnées"
             accesskey="N">suivant</a></li>
        <li class="right" >
          <a href="raster.html" title="F.A.Q. Raster"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">GDAL v1.9.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">FAQ</a> &raquo;</li> 
      </ul>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table des matières</a></h3>
            <ul>
<li><a class="reference internal" href="#">FAQ vecteur</a><ul>
<li><a class="reference internal" href="#comment-puis-je-fusionner-des-100e-de-shapefiles">Comment puis je fusionner des 100e de shapefiles ?</a></li>
<li><a class="reference internal" href="#comment-traduire-un-fichier-de-geometrie-melangee-vers-le-format-shapfile">Comment traduire un fichier de géométrie mélangée vers le format shapfile ?</a></li>
<li><a class="reference internal" href="#comment-proteger-les-parametres-des-commandes-gdal-ogr-sous-la-console-microsoft-windows">Comment protéger les paramètres des commandes GDAL/OGR sous la console Microsoft Windows ?</a></li>
<li><a class="reference internal" href="#comment-recuperer-les-formats-geres-par-ogr">Comment récupérer les formats gérés par ogr ?</a></li>
<li><a class="reference internal" href="#comment-recuperer-des-informations-sur-la-couche-vectorielle">Comment récupérer des informations sur la couche vectorielle ?</a></li>
<li><a class="reference internal" href="#comment-ecrire-dans-une-base-de-donnees-postgis">Comment écrire dans une base de données POSTGIS ?</a></li>
<li><a class="reference internal" href="#comment-lire-une-base-de-donnees-au-format-vmap0">Comment lire une base de données au format VMAP0 ?</a></li>
<li><a class="reference internal" href="#comment-recuperer-une-zone-geographique-precise-dans-une-jeu-de-donnees">Comment récupérer une zone géographique précise dans une jeu de données ?</a></li>
</ul>
</li>
</ul>

            <h4>Sujet précédent</h4>
            <p class="topless"><a href="raster.html"
                                  title="Chapitre précédent">F.A.Q. Raster</a></p>
            <h4>Sujet suivant</h4>
            <p class="topless"><a href="proj.html"
                                  title="Chapitre suivant">FAQ Projection et système de coordonnées</a></p>
            <h3>Cette page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/faq/vecteur.txt"
                     rel="nofollow">Montrer la source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Recherche rapide</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="faq-vecteur">
<span id="gdal-faq-ogr"></span><h1>FAQ vecteur<a class="headerlink" href="#faq-vecteur" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="comment-puis-je-fusionner-des-100e-de-shapefiles">
<h2>Comment puis je fusionner des 100e de shapefiles ?<a class="headerlink" href="#comment-puis-je-fusionner-des-100e-de-shapefiles" title="Lien permanent vers ce titre">¶</a></h2>
<p>Voici un script bash pour charger en masse un répertoire de shapefile qui ont
le même schéma dans postgis. Il peut évidemment être amélioré, mais il fonctionne.</p>
<div class="highlight-python"><pre>#!/bin/bash

# let OGR create a table from one of the files
ogr2ogr -f Postgresql PG:"host=smoke.hobu.net" -a_srs "EPSG:26915" -nln outputlayer first_input_shape.shp -overwrite -nlt POLYGON

# delete all the data in the table we just created (but don't delete the table)
ogrinfo PG:"host=smoke.hobu.net" -sql "delete  from outputlayer"

# loop through all of the shapefiles in the directory and load them
for i in $(ls *.shp); do
ogr2ogr -f Postgresql PG:"host=smoke.hobu.net" -a_srs " EPSG:26915" -nln outputlayer $i -update -append -skipfailures
done</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">si vous avez une erreur d&#8217;import de PostGIS similaire à &#8220;<em>ERROR: new row for
relation &#8220;layer1&#8221; violates check constraint</em>&#8221;  vous devez essayer de
substituer &#8220;<em>-nlt GEOMETRY</em>&#8221; par votre type de géométrie (dans l&#8217;exemple
ci-dessus ce sont des POLYGON). Cela évitera des erreurs si votre shapefiles
inclues des géométries de types polygones et des multipolygones, par exemple.
Lisez ce message pour plus d&#8217;information :
<a class="reference external" href="http://postgis.refractions.net/pipermail/postgis-users/2006-June/012495.html">http://postgis.refractions.net/pipermail/postgis-users/2006-June/012495.html</a></p>
</div>
<p>Ces étapes de consoles Unix illustre comment batcher une fusion multiple de
shapefiles en un seul shapefil en utilisant OGR. Cela suppose que vous avez
téléchargé un groupe de shapefile dans un fichier .zip qui sont tous de même
type de données mais nécessite juste d&#8217;être combiné. Cela fonctionne sous Mac
mais n&#8217;a pas été testé sous d&#8217;autres versions d&#8217;Unix :</p>
<div class="highlight-python"><pre>#Make a new directory called "tmp" and a sub directory called "merged"
mkdir tmp
mkdir tmp/merged

#copy all zipped files to the "tmp" directory and then "cd" into it
cp *.zip tmp
cd tmp

#unzip all the .zip archives
find . -name "*.zip" -exec unzip '{}' \;

#delete all .zip archives
rm *.zip

#move a single shapefile (and the cooresponded .shx, .dbf, etc files) to the "merged" directory
#(exchange 'myshape*' for the name of one of your shapefiles keeping the '*' at the end of the name)
find . -name 'myshape*' -exec mv '{}' merged \;

#Batch merge all the remaining shapefiles from the tmp dir into the copied file in the merge dir
#(exchange 'myshape' for the name of the copied shapefile)
for i in $(ls *.shp); do ogr2ogr -f 'ESRI Shapefile' -update -append merged $i -nln myshape
done</pre>
</div>
<p>Cet exemple de console <tt class="docutils literal"><span class="pre">cmd</span></tt> Windows fusionne de multiple shapefile <em>wetlands</em>
dans le répertoire actuel à un seule fichier <em>mergedwetlands.shp</em> (doublez les
% pour mettre dans une script , %f &#8211;&gt; %%f) :</p>
<div class="highlight-python"><pre>mkdir merged
for %f in (*wetland*.shp) do (
if not exist merged\wetlands.shp (
    ogr2ogr -f "esri shapefile" merged\wetlands.shp %f) else (
    ogr2ogr -f "esri shapefile" -update -append merged\wetlands.shp %f -nln Wetlands )
)</pre>
</div>
<p>Le truc est d&#8217;utiliser la première entré pour créer un nouveau shapefile puis
seulement de mettre à jour. Voyez la fin de <a class="reference internal" href="../ogr/formats/shapefile.html#gdal-ogr-formats-shapefile"><em>ESRI Shapefile</em></a>.</p>
<p>si vous n&#8217;avez pas besoin de définir un nom lisible par un humain via <em>-nln</em>,
en utilisant <em>-append</em> est plus simple :</p>
<div class="highlight-python"><pre>for %f in (dir1\*.shp dir2\*.shp) do (ogr2ogr -f "esri shapefile" -append merged %f)</pre>
</div>
</div>
<div class="section" id="comment-traduire-un-fichier-de-geometrie-melangee-vers-le-format-shapfile">
<h2>Comment traduire un fichier de géométrie mélangée vers le format shapfile ?<a class="headerlink" href="#comment-traduire-un-fichier-de-geometrie-melangee-vers-le-format-shapfile" title="Lien permanent vers ce titre">¶</a></h2>
<p>Certains formats (tel que les Shapefiles d&#8217;ESRI) permet seulement un type de
géométrie dans une couche, tandis que d&#8217;autres (comme les formats DGN, MapInfo,
GML) permettent de mélanger des types de géométries dans une seule couche. Les
tentatives de transformation résultera en des erreurs comme cela :</p>
<div class="highlight-python"><pre>% ogr2ogr out.shp mixed.dgn
ERROR 1: Attempt to write non-linestring (POLYGON) geometry to ARC type shapefile.
ERROR 1: Terminating translation prematurely after failed
translation of layer elements</pre>
</div>
<p>La première étape dans la prise en charge de tel problème est de découvrir
quels types de géométries existent dans le fichier source. Pour une fichier DGN
appelé <em>mixed.dgn</em>, avec une couche appelé <em>elements</em> cela peut être accomplie
en utilisant la commande SQL d&#8217;OGR (voyez [[ogr_sql]] pour les détails).</p>
<div class="highlight-python"><pre>% ogrinfo -ro mixed.dgn -sql 'select distinct ogr_geometry from elements'
INFO: Open of `mixed.dgn'
    using driver `DGN' successful.

Layer name: elements
Geometry: Unknown (any)
Feature Count: 1
Layer SRS WKT:
(unknown)
ogr_geometry: String (0.0)
OGRFeature(elements):0
ogr_geometry (String) = LINESTRING

OGRFeature(elements):1
ogr_geometry (String) = POLYGON

OGRFeature(elements):2
ogr_geometry (String) = POINT</pre>
</div>
<p>Ce fichier a des géométries points, lignes et polygones. Chacun doit être
transmis dans un fichier séparé.</p>
<div class="highlight-python"><pre>% ogr2ogr out_point.shp mixed.dgn -where 'ogr_geometry = "POINT"'
% ogr2ogr out_line.shp mixed.dgn -where 'ogr_geometry = "LINESTRING"'
% ogr2ogr out_poly.shp mixed.dgn -where 'ogr_geometry = "POLYGON"'</pre>
</div>
</div>
<div class="section" id="comment-proteger-les-parametres-des-commandes-gdal-ogr-sous-la-console-microsoft-windows">
<h2>Comment protéger les paramètres des commandes GDAL/OGR sous la console Microsoft Windows ?<a class="headerlink" href="#comment-proteger-les-parametres-des-commandes-gdal-ogr-sous-la-console-microsoft-windows" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lorsque vous travaillez avec une console Windows, il est utile de se souvenir
que les règles de protection sont différent de ceux utilisé sous unix. Voici un
exemple de protection correcte de requête SQL passé à ogrinfo (ou ogr2ogr) avec
l&#8217;option <em>-sql</em> :</p>
<div class="highlight-python"><pre>ogrinfo . -sql "SELECT * FROM 'B_Major Cities 1' WHERE FID = 49"</pre>
</div>
<p>La requête SQL complète est entouré de guillemets doubles, mais pas de
guillemets simples. Le nom de la table (ici il fonctionne pour des shapefiles
ESRI dans le répertoire courant, notez le point) inclues les espaces, il doit
donc être entouré avec des guillemets simples.</p>
<p>Par exemple, ces deux variantes présentent des commandes incorrectes :</p>
<div class="highlight-python"><pre>ogrinfo . -sql 'SELECT * FROM 'B_Major Cities 1' WHERE FID = 49'
ogrinfo . -sql 'SELECT * FROM "B_Major Cities 1" WHERE FID = 49'</pre>
</div>
</div>
<div class="section" id="comment-recuperer-les-formats-geres-par-ogr">
<h2>Comment récupérer les formats gérés par ogr ?<a class="headerlink" href="#comment-recuperer-les-formats-geres-par-ogr" title="Lien permanent vers ce titre">¶</a></h2>
<blockquote>
<div><p>Comme pour gdal, il suffit d&#8217;utiliser le paramètre &#8211;formats (avec un s ;-) :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ogrinfo</span> <span class="o">--</span><span class="n">formats</span>
</pre></div>
</div>
<p>renverra :</p>
<div class="highlight-python"><pre>$ ogrinfo --formats
Supported Formats:
    -&gt; "GRASS" (readonly)
    -&gt; "ESRI Shapefile" (read/write)
    -&gt; "MapInfo File" (read/write)
    -&gt; "UK .NTF" (readonly)
    -&gt; "SDTS" (readonly)
    -&gt; "TIGER" (read/write)
    -&gt; "S57" (read/write)
    -&gt; "DGN" (read/write)
    -&gt; "VRT" (readonly)
    -&gt; "AVCBin" (readonly)
    -&gt; "REC" (readonly)
    -&gt; "Memory" (read/write)
    -&gt; "CSV" (read/write)
    -&gt; "GML" (read/write)
    -&gt; "KML" (read/write)
    -&gt; "ODBC" (read/write)
    -&gt; "PGeo" (readonly)
    -&gt; "OGDI" (readonly)
    -&gt; "PostgreSQL" (read/write)</pre>
</div>
</div></blockquote>
</div>
<div class="section" id="comment-recuperer-des-informations-sur-la-couche-vectorielle">
<h2>Comment récupérer des informations sur la couche vectorielle ?<a class="headerlink" href="#comment-recuperer-des-informations-sur-la-couche-vectorielle" title="Lien permanent vers ce titre">¶</a></h2>
<p>La commande ogrinfo permet de récupérer un grand nombre d&#8217;information d&#8217;une
couche. Dans une première étape on récupère les informations contenu dans le
jeu de données :</p>
<div class="highlight-python"><pre>$ ogrinfo clc00_fr.shp
INFO: Open of `clc00_fr.shp'
        using driver `ESRI Shapefile' successful.
1: clc00_fr (Polygon)</pre>
</div>
<p>Les fichiers shp possèdent toujours une couche dont le nom est le même que le
nom du fichier. Certains fichiers possèdent plusieurs couches qu&#8217;il est
possible de différencier par ce moyen.</p>
<p>Pour obtenir des informations sur une couche du jeu de données, lancez la
commande suivante :</p>
<div class="highlight-python"><pre>$ ogrinfo -so clc00_fr.shp clc00_fr
INFO: Open of `clc00_fr.shp'
        using driver `ESRI Shapefile' successful.

Layer name: clc00_fr
Geometry: Polygon
Feature Count: 270465
Extent: (37256.000205, 1607395.375873) - (1207902.000605, 2687734.936295)
Layer SRS WKT:
PROJCS["NTF_Lambert_II_étendu",
    GEOGCS["GCS_NTF",
        DATUM["Nouvelle_Triangulation_Francaise",
            SPHEROID["Clarke_1880_IGN",6378249.2,293.46602]],
        PRIMEM["Greenwich",0.0],
        UNIT["Degree",0.0174532925199433]],
    PROJECTION["Lambert_Conformal_Conic_1SP"],
    PARAMETER["False_Easting",600000.0],
    PARAMETER["False_Northing",2200000.0],
    PARAMETER["Central_Meridian",2.3372291667],
    PARAMETER["Standard_Parallel_1",45.8989188889],
    PARAMETER["Standard_Parallel_2",47.6960144444],
    PARAMETER["Scale_Factor",1.0],
    PARAMETER["Latitude_Of_Origin",46.8],
    UNIT["Meter",1.0]]
CODE_00: String (3.0)</pre>
</div>
<p>Notez le paramètre <tt class="docutils literal"><span class="pre">-so</span></tt> qui permet de récupérer un <strong>résumé</strong> des
informations de la couche. En absence de ce paramètre, <tt class="docutils literal"><span class="pre">ogrinfo</span></tt> renverra
le contenu du fichier, c&#8217;est à dire les objets géographiques et la table
attributaire !</p>
</div>
<div class="section" id="comment-ecrire-dans-une-base-de-donnees-postgis">
<h2>Comment écrire dans une base de données POSTGIS ?<a class="headerlink" href="#comment-ecrire-dans-une-base-de-donnees-postgis" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour écrire dans une base de données PostGIS à partir de fichier shapefile :</p>
<div class="highlight-python"><pre>ogr2ogr -f “PostgreSQL” PG:”host=myhost user=myloginname dbname=mydbname password=mypassword” myshapefile.shp</pre>
</div>
</div>
<div class="section" id="comment-lire-une-base-de-donnees-au-format-vmap0">
<h2>Comment lire une base de données au format VMAP0 ?<a class="headerlink" href="#comment-lire-une-base-de-donnees-au-format-vmap0" title="Lien permanent vers ce titre">¶</a></h2>
<ul>
<li><p class="first">Pour lire un fichier vmap0</p>
<div class="highlight-python"><pre>ogrinfo -ro -summary gltp:/vrf/mnt/data/v0eur/vmaplv0/eurnasia ‘polbnda@bnd(*)_area’</pre>
</div>
</li>
</ul>
<p>En cas de problème (format non reconnue), pensez à vérifier que le format OGDI
est bien listé dans la liste des formats supportés. Si tel est le cas, vérifiez
qu&#8217;il n&#8217;y ait pas de casse différente dans le nom du fichier (Document/Sig/
par exemple ne passera pas).</p>
<ul>
<li><p class="first">Pour créer un fichier shp à partir d’une fichier VMAP0 :</p>
<div class="highlight-python"><pre>ogr2ogr watrcrsl.shp gltp:/vrf/mnt/data/v0eur/vmaplv0/eurnasia ‘watrcrsl@hydro(*)_line’</pre>
</div>
</li>
<li><p class="first">Autre exemple, celui-ci permet de créer un fichier Shape en Lambert 2 étendue :</p>
<div class="highlight-python"><pre>ogr2ogr -t_srs ‘EPSG:27582’ contourl.shp gltp:/vrf/mnt/data/v0eur/vmaplv0/eurnasia “contourl@elev(*)_line”</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="comment-recuperer-une-zone-geographique-precise-dans-une-jeu-de-donnees">
<h2>Comment récupérer une zone géographique précise dans une jeu de données ?<a class="headerlink" href="#comment-recuperer-une-zone-geographique-precise-dans-une-jeu-de-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>FIXME</p>
<p>Le paramètre <tt class="docutils literal"><span class="pre">-spat</span></tt> permet de définir une bbox :</p>
<div class="highlight-python"><pre>ogr2ogr -spat xmin ymin xmax ymax</pre>
</div>
<p>Par exemple, en France :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ogr2ogr</span> <span class="o">-</span><span class="n">spat</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>


      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="proj.html" title="FAQ Projection et système de coordonnées"
             >suivant</a></li>
        <li class="right" >
          <a href="raster.html" title="F.A.Q. Raster"
             >précédent</a> |</li>
        <li><a href="../index.html">GDAL v1.9.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >FAQ</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    <a href="http://creativecommons.org/licenses/by/2.0/fr/deed.fr">Licence Creative Common BY</a>
    <!--
      &copy; Copyright 2011, Yves Jacolin.-->
      Créé avec <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>